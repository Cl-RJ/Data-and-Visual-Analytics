<!DOCTYPE html>

<head>
  <title>Line Charts</title>
  <meta charset="utf-8">

  <script type="text/javascript" src="../lib/d3.v5.min.js"></script>
  
</head>

<body>
  <div id='signature'>rpeng37</div>
  
  <script>
    const margin = {
      top: 50,
      right: 150,
      bottom: 50,
      left: 90
    };
    const width = 800 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;

    const svg1 = d3.select("body")
      .append("svg")
        .attr("id", "svg-a")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("id", "plot-a")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    svg1.append("text")
      .attr("id", "title-a")
      .attr("x", width / 2)
      .attr("y", -margin.top / 2)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Number of Ratings 2016-2020");

    d3.csv("boardgame_ratings.csv").then(function(data) {
      console.log("Data loaded:", data);

      const parseDate = d3.timeParse("%Y-%m-%d");
      data.forEach(d => {
        d.date = parseDate(d.date);
      });

      const x = d3.scaleTime()
        .domain(d3.extent(data, d => d.date))
        .range([0, width]);

      const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d3.max([
          +d["Catan=count"], +d["Dominion=count"], +d["Codenames=count"], 
          +d["Terraforming Mars=count"], +d["Gloomhaven=count"], 
          +d["Magic: The Gathering=count"], +d["Dixit=count"], +d["Monopoly=count"]
        ]))])
        .range([height, 0]);

      svg1.append("g")
        .attr("id", "x-axis-a")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat("%b %y")))
        .append("text")
        .attr("x", width / 2)
        .attr("y", margin.bottom - 10)
        .attr("text-anchor", "middle")
        .text("Month");

      svg1.append("g")
        .attr("id", "y-axis-a")
        .call(d3.axisLeft(y))
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", -margin.left + 20)
        .attr("dy", "1em")
        .attr("text-anchor", "middle")
        .style("fill", "#000")
        .text("Num of Ratings");

      const linesGroup = svg1.append("g")
        .attr("id", "lines-a");

      const games = ["Catan", "Dominion", "Codenames", "Terraforming Mars",
        "Gloomhaven", "Magic: The Gathering", "Dixit", "Monopoly"];

      const line = d3.line()
        .x(d => x(d.date))
        .y(d => y(d.count));

      games.forEach((game, i) => {
        const gameData = data.map(d => ({
          date: d.date,
          count: +d[game + "=count"]
        }));

        linesGroup.append("path")
          .datum(gameData)
          .attr("class", "line")
          .style("stroke", d3.schemeCategory10[i])
          .attr("fill", "none")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        linesGroup.append("text")
          .attr("x", x(data[data.length-1].date) + 5)
          .attr("y", y(data[data.length-1][game + "=count"]))
          .attr("dy", ".35em")
          .attr("text-anchor", "start")
          .style("fill", d3.schemeCategory10[i])
          .text(game);
      });

      svg1.append("text")
        .attr("x", width / 2)
        .attr("y", height + margin.bottom - 10)
        .attr("text-anchor", "middle")
        .text("Month");
    }).catch(error => {
      console.error("Error loading the data:", error);
    });

    const svg2 = d3.select("body")
      .append("svg")
        .attr("id", "svg-b")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("id", "plot-b")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    svg2.append("text")
      .attr("id", "title-b")
      .attr("x", width / 2)
      .attr("y", -margin.top / 2)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Number of Ratings 2016-2020 with Rankings");

    d3.csv("boardgame_ratings.csv").then(function(data) {
      data.forEach(d => {
        d.date = d3.timeParse("%Y-%m-%d")(d.date);
      });

      const x = d3.scaleTime()
        .domain(d3.extent(data, d => d.date))
        .range([0, width]);

      const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d3.max([
          +d["Catan=count"], +d["Dominion=count"], +d["Codenames=count"], 
          +d["Terraforming Mars=count"], +d["Gloomhaven=count"], 
          +d["Magic: The Gathering=count"], +d["Dixit=count"], +d["Monopoly=count"]
        ]))])
        .range([height, 0]);

      const linesGroup = svg2.append("g")
        .attr("id", "lines-b");

      const allGames = ["Catan", "Dominion", "Codenames", "Terraforming Mars",
        "Gloomhaven", "Magic: The Gathering", "Dixit", "Monopoly"];
      
      const targetGames = ["Catan", "Codenames", "Terraforming Mars", "Gloomhaven"];

      const line = d3.line()
        .x(d => x(d.date))
        .y(d => y(d.count));

      allGames.forEach((game, i) => {
        const gameData = data.map(d => ({
          date: d.date,
          count: +d[game + "=count"]
        }));

        linesGroup.append("path")
          .datum(gameData)
          .attr("fill", "none")
          .attr("stroke", d3.schemeCategory10[i])
          .attr("stroke-width", 1.5)
          .attr("d", line);

        linesGroup.append("text")
          .attr("x", x(data[data.length-1].date) + 5)
          .attr("y", y(data[data.length-1][game + "=count"]))
          .attr("dy", ".35em")
          .attr("text-anchor", "start")
          .style("fill", d3.schemeCategory10[i])
          .text(game);
      });

      svg2.append("g")
        .attr("id", "x-axis-b")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat("%b %y")))
        .append("text")
        .attr("x", width / 2)
        .attr("y", margin.bottom - 10)
        .attr("text-anchor", "middle")
        .text("Month");

      svg2.append("g")
        .attr("id", "y-axis-b")
        .call(d3.axisLeft(y))
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", -margin.left + 20)
        .attr("dy", "1em")
        .attr("text-anchor", "middle")
        .style("fill", "#000")
        .text("Num of Ratings");

      const symbolsGroup = svg2.append("g")
        .attr("id", "symbols-b");

      const xTickValues = x.ticks(d3.timeMonth.every(3));
      const tickData = data.filter(d => 
        xTickValues.some(tick => tick.getTime() === d.date.getTime())
      );

      targetGames.forEach((game) => {
        const i = allGames.indexOf(game);
        
        symbolsGroup.selectAll(`.circle-${game}`)
          .data(tickData)
          .enter()
          .append("circle")
          .attr("cx", d => x(d.date))
          .attr("cy", d => y(d[game + "=count"]))
          .attr("r", 12)
          .style("fill", d3.schemeCategory10[i]);

        symbolsGroup.selectAll(`.rank-${game}`)
          .data(tickData)
          .enter()
          .append("text")
          .attr("x", d => x(d.date))
          .attr("y", d => y(d[game + "=count"]))
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .style("fill", "white")
          .style("font-size", "10px")
          .text(d => d[game + "=rank"]);
      });

      const legend = svg2.append("g")
        .attr("id", "legend-b")
        .attr("transform", `translate(${width + 50}, ${height - 50})`);

      legend.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", 12)
        .style("fill", "black");

      legend.append("text")
        .attr("x", 0)
        .attr("y", 0)
        .attr("dy", ".35em")
        .attr("text-anchor", "middle")
        .style("fill", "white")
        .style("font-size", "10px")
        .text("rank");

      legend.append("text")
        .attr("x", 0)
        .attr("y", 35)
        .attr("text-anchor", "middle")
        .text("BoardGameGeek Rank");

      
      svg2.append("text")
        .attr("x", width / 2)
        .attr("y", height + margin.bottom - 10)
        .attr("text-anchor", "middle")
        .text("Month");
    }).catch(error => {
      
      console.error("Error loading the data:", error);
    });

    const svg3 = d3.select("body")
      .append("svg")
        .attr("id", "svg-c-1")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("id", "plot-c-1")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    svg3.append("text")
      .attr("id", "title-c-1")
      .attr("x", width / 2)
      .attr("y", -margin.top / 2)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Number of Ratings 2016-2020 (Square root Scale)");

    const svg4 = d3.select("body")
      .append("svg")
        .attr("id", "svg-c-2")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("id", "plot-c-2")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    svg4.append("text")
      .attr("id", "title-c-2")
      .attr("x", width / 2)
      .attr("y", -margin.top / 2)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Number of Ratings 2016-2020 (Log Scale)");

    function createScaledChart(svg, scaleType, chartId) {
      d3.csv("boardgame_ratings.csv").then(function(data) {
        data.forEach(d => {
          d.date = d3.timeParse("%Y-%m-%d")(d.date);
        });

        const x = d3.scaleTime()
          .domain(d3.extent(data, d => d.date))
          .range([0, width]);

        const y = scaleType === 'sqrt' 
          ? d3.scaleSqrt()
              .domain([0, d3.max(data, d => d3.max([
                +d["Catan=count"], +d["Dominion=count"], +d["Codenames=count"], 
                +d["Terraforming Mars=count"], +d["Gloomhaven=count"], 
                +d["Magic: The Gathering=count"], +d["Dixit=count"], +d["Monopoly=count"]
              ]))])
              .range([height, 0])
          : d3.scaleLog()
              .domain([1, d3.max(data, d => d3.max([
                +d["Catan=count"], +d["Dominion=count"], +d["Codenames=count"], 
                +d["Terraforming Mars=count"], +d["Gloomhaven=count"], 
                +d["Magic: The Gathering=count"], +d["Dixit=count"], +d["Monopoly=count"]
              ]))])
              .range([height, 0]);

        const linesGroup = svg.append("g")
          .attr("id", `lines-${chartId}`);

        const allGames = ["Catan", "Dominion", "Codenames", "Terraforming Mars",
          "Gloomhaven", "Magic: The Gathering", "Dixit", "Monopoly"];
          
        const targetGames = ["Catan", "Codenames", "Terraforming Mars", "Gloomhaven"];

        const line = d3.line()
          .x(d => x(d.date))
          .y(d => y(d.count));

        allGames.forEach((game, i) => {
          const gameData = data.map(d => ({
            date: d.date,
            count: scaleType === 'log' ? Math.max(1, +d[game + "=count"]) : +d[game + "=count"]
          }));

          linesGroup.append("path")
            .datum(gameData)
            .attr("fill", "none")
            .attr("stroke", d3.schemeCategory10[i])
            .attr("stroke-width", 1.5)
            .attr("d", line);

          linesGroup.append("text")
            .attr("x", x(data[data.length-1].date) + 5)
            .attr("y", y(scaleType === 'log' 
              ? Math.max(1, +data[data.length-1][game + "=count"])
              : +data[data.length-1][game + "=count"]))
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .style("fill", d3.schemeCategory10[i])
            .text(game);
        });

        svg.append("g")
          .attr("id", `x-axis-${chartId}`)
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x).ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat("%b %y")))
          .append("text")
          .attr("x", width / 2)
          .attr("y", margin.bottom - 10)
          .attr("text-anchor", "middle")
          .text("Month");

        svg.append("g")
          .attr("id", `y-axis-${chartId}`)
          .call(d3.axisLeft(y))
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("x", -height / 2)
          .attr("y", -margin.left + 20)
          .attr("dy", "1em")
          .attr("text-anchor", "middle")
          .style("fill", "#000")
          .text("Num of Ratings");

        const symbolsGroup = svg.append("g")
          .attr("id", `symbols-${chartId}`);

        const xTickValues = x.ticks(d3.timeMonth.every(3));
        const tickData = data.filter(d => 
          xTickValues.some(tick => tick.getTime() === d.date.getTime())
        );

        targetGames.forEach((game) => {
          const i = allGames.indexOf(game);
          
          symbolsGroup.selectAll(`.circle-${game}`)
            .data(tickData)
            .enter()
            .append("circle")
            .attr("cx", d => x(d.date))
            .attr("cy", d => y(scaleType === 'log' 
              ? Math.max(1, +d[game + "=count"])
              : +d[game + "=count"]))
            .attr("r", 12)
            .style("fill", d3.schemeCategory10[i]);

          symbolsGroup.selectAll(`.rank-${game}`)
            .data(tickData)
            .enter()
            .append("text")
            .attr("x", d => x(d.date))
            .attr("y", d => y(scaleType === 'log' 
              ? Math.max(1, +d[game + "=count"])
              : +d[game + "=count"]))
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .style("fill", "white")
            .style("font-size", "10px")
            .text(d => d[game + "=rank"]);
        });

        const legend = svg.append("g")
          .attr("id", `legend-${chartId}`)
          .attr("transform", `translate(${width + 50}, ${height - 50})`);

        legend.append("circle")
          .attr("cx", 0)
          .attr("cy", 0)
          .attr("r", 12)
          .style("fill", "black");

        legend.append("text")
          .attr("x", 0)
          .attr("y", 0)
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .style("fill", "white")
          .style("font-size", "10px")
          .text("rank");

        legend.append("text")
          .attr("x", 0)
          .attr("y", 35)
          .attr("text-anchor", "middle")
          .text("BoardGameGeek Rank");

        
        svg.append("text")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom - 10)
          .attr("text-anchor", "middle")
          .text("Month");
      });
    }

    createScaledChart(svg3, 'sqrt', 'c-1');
    createScaledChart(svg4, 'log', 'c-2');

    svg4.append("text")
      .attr("x", width + margin.right - 20)
      .attr("y", height + margin.bottom - 10)
      .attr("text-anchor", "end")
      .style("font-family", "monospace")
      .text("rpeng37");
  </script>
</body>
